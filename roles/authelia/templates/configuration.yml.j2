server:
  address: tcp://0.0.0.0:{{authelia_port}}/
  buffers:
    read: 4096
    write: 4096
  disable_healthcheck: false
  asset_path: /config/assets/
  endpoints:
    enable_pprof: false
    enable_expvars: false

log:
  level: debug

access_control:
  default_policy: two_factor
  networks:
  - name: internal
    networks:
    - 192.168.1.0/24
  rules:
  - domain: "*.{{project_tld}}"
    policy: bypass
    resources:
    - "^/api/.*$"
    - "^/identity/.*$"
    - "^/triggers/.*$"
    - "^/meshagents.*$"
    - "^/meshsettings.*$"
    - "^/agent.*$"
    - "^/control.*$"
    - "^/meshrelay.*$"
    - "^/github-webhook/.*$"
  - domain: "music.{{project_tld}}"
    policy: bypass
    resources:
    - "^/rest/.*$"
    - "^/share/.*$"
  - domain: "music.{{project_tld}}"
    policy: bypass
    networks:
    - internal
  - domain: "login.{{project_tld}}"
    policy: bypass
  - domain: api.{{project_tld}}
    policy: two_factor
    subject:
    - "group:Authelia_Admins"
  - domain: "portainer.{{project_tld}}"
    policy: bypass
    networks:
    - internal
  - domain: "ci.{{project_tld}}"
    policy: bypass
    networks:
    - internal
  - domain: "codeserver.{{project_tld}}"
    policy: bypass
    networks:
    - internal
  - domain: "grafana.{{project_tld}}"
    policy: bypass
    networks:
    - internal
  - domain: "mylar.{{project_tld}}"
    policy: bypass
    networks:
    - internal
  - domain: "radarr.{{project_tld}}"
    policy: bypass
    networks:
    - internal
  - domain: "sonarr.{{project_tld}}"
    policy: bypass
    networks:
    - internal
  - domain: "sonarr2.{{project_tld}}"
    policy: bypass
    networks:
    - internal
  - domain: "lidarr.{{project_tld}}"
    policy: bypass
    networks:
    - internal
  - domain: "prowlarr.{{project_tld}}"
    policy: bypass
    networks:
    - internal
  - domain: "readarr.{{project_tld}}"
    policy: bypass
    networks:
    - internal
  - domain: "readarraudio.{{project_tld}}"
    policy: bypass
    networks:
    - internal
  - domain: "adminer.{{project_tld}}"
    policy: bypass
    networks:
    - internal
  - domain: "ombi.{{project_tld}}"
    policy: bypass
    networks:
    - internal
  - domain: "join.{{project_tld}}"
    resources:
    - '^/j/'
    - '^/join/'
    - '^/setup/*'
    - '^/static/'
    policy: bypass
  - domain: "join.{{project_tld}}"
    policy: bypass
    networks:
    - internal
  - domain: "ldapmanager.{{project_tld}}"
    policy: bypass
    networks:
    - internal
  - domain: "amp.{{project_tld}}"
    policy: bypass
    networks:
    - internal
  - domain: "mesh.{{project_tld}}"
    policy: bypass
    networks:
    - internal
  - domain: "wiki.{{project_tld}}"
    policy: bypass
    networks:
    - internal
  - domain: "{{home_tld}}/phpldapadmin"
    policy: bypass
    networks:
    - internal
  - domain: cyberchef.{{project_tld}}
    policy: two_factor
    subject:
    - "group:Authelia_Admins"
  - domain: sonarr.{{project_tld}}
    policy: two_factor
    subject:
    - "group:Media_Users"
  - domain: sonarr2.{{project_tld}}
    policy: two_factor
    subject:
    - "group:Media_Users"
  - domain: radarr.{{project_tld}}
    policy: two_factor
    subject:
    - "group:Media_Users"
  - domain: lidarr.{{project_tld}}
    policy: two_factor
    subject:
    - "group:Media_Users"
  - domain: readarr.{{project_tld}}
    policy: two_factor
    subject:
    - "group:Media_Users"
  - domain: readarraudio.{{project_tld}}
    policy: two_factor
    subject:
    - "group:Media_Users"
  - domain: mylar.{{project_tld}}
    policy: two_factor
    subject:
    - "group:Media_Users"
  - domain: prowlarr.{{project_tld}}
    policy: two_factor
    subject:
    - "group:Media_Users"
  - domain: sabnzbd.{{project_tld}}
    policy: two_factor
    subject:
    - "group:Media_Users"
  - domain: transmission.{{project_tld}}
    policy: two_factor
    subject:
    - "group:Media_Users"
  - domain: bazarr.{{project_tld}}
    policy: two_factor
    subject:
    - "group:Media_Users"
  - domain: print.{{project_tld}}
    policy: two_factor
    subject:
    - "group:Media_Users"
  - domain: "kavita.{{project_tld}}"
    policy: bypass
    networks:
    - internal
  - domain: "comics.{{project_tld}}"
    policy: bypass
    networks:
    - internal
  - domain: "audiobooks.{{project_tld}}"
    policy: bypass
    networks:
    - internal
  - domain: "books.{{project_tld}}"
    policy: bypass
    networks:
    - internal
  - domain: "photos.{{project_tld}}"
    policy: bypass
    networks:
    - internal
  - domain: "www.{{project_tld}}"
    policy: bypass
    networks:
    - internal
  - domain: "guac.{{project_tld}}"
    policy: bypass
    networks:
    - internal

authentication_backend:
  password_reset:
    disable: false
  ldap:
    address: {{ authelia_ldap_url }}
    base_dn: {{ authelia_ldap_base_dn }}
    additional_users_dn: ou=users
    users_filter: (&({username_attribute}={input})(objectClass=person))
    additional_groups_dn: ou=groups
    groups_filter: (&(member={dn})(objectclass=groupofNames))
    user: {{authelia_ldap_user}}
    password: {{authelia_ldap_password}}
    attributes:
      username: uid
      group_name: cn
      mail: mail
      display_name: cn

#identity_providers:
#  oidc:
#    ## The other portions of the mandatory OpenID Connect 1.0 configuration go here.
#    ## See: https://www.authelia.com/c/oidc
#    clients:
#      - client_id: '{{ authelia_oauth_portainer_clientid }}'
#        client_name: 'Portainer'
#       client_secret: '{{ authelia_oauth_portainer_secret }}'
#       public: false
#       authorization_policy: 'two_factor'
#       redirect_uris:
#          - 'https://portainer.theboucher6.com'
#        scopes:
#          - 'openid'
#          - 'profile'
#         - 'groups'
#         - 'email'
#       userinfo_signed_response_alg: 'none'

storage:
  encryption_key: {{authelia_encryption_key}}
  postgres:
    address: tcp://{{postgres_hostname}}:{{postgres_port}}
    database: {{authelia_database}}
    schema: public
    username: {{authelia_database_user}}
    password: {{authelia_database_password}}

session:
  name: authelia_session
  # domain: {{project_tld}}
  secret: {{authelia_session_secret}}
  expiration: 4h
  inactivity: 1h
  remember_me: 1M
  cookies:
    - domain: {{project_tld}}
      authelia_url: https://login.{{project_tld}}/
      default_redirection_url: https://www.{{project_tld}}/
      name: authelia_session
      same_site: lax
      inactivity: 1h
      expiration: 4h
      remember_me: 1d
  redis:
    host: {{redis_hostname}}
    port: {{redis_port}}
    password: {{redis_password}}
    database_index: 1
    maximum_active_connections: 8
    minimum_idle_connections: 0
    high_availability:
      sentinel_name: {{redis_sentinel_name}}
      # If `sentinel_username` is supplied, Authelia will connect using ACL-based
      # authentication. Otherwise, it will use traditional `requirepass` auth.
      sentinel_password: {{redis_password}}
      nodes:
        - host: {{redis_sentinel_node1}}
          port: {{redis_sentinel_port}}
        - host: {{redis_sentinel_node2}}
          port: {{redis_sentinel_port}}
        - host: {{redis_sentinel_node3}}
          port: {{redis_sentinel_port}}
      route_by_latency: false
      route_randomly: false 

notifier:
  disable_startup_check: false
  smtp:
    address: smtp://{{email_host}}:{{email_port}}
    timeout: 5s
    username: {{email_user}}
    password: {{email_password}}
    sender: "{{authelia_notifier_sender}}"
    subject: "[Authelia] {title}"
    startup_check_address: {{authelia_notifier_startup_check_address}}
    disable_require_tls: false
    disable_html_emails: false

regulation:
  max_retries: 3
  find_time: 2m
  ban_time: 5m

ntp:
  address: 'udp://time.cloudflare.com:123'
  version: 3
  max_desync: 3s
  disable_startup_check: false
  disable_failure: false

totp:
  issuer: H2OHome
  algorithm: sha1
  digits: 6
  period: 30
  skew: 1

duo_api:
  hostname: {{authelia_duo_hostname}}
  integration_key: {{authelia_duo_integration_key}}
  secret_key: {{authelia_duo_secret_key}}

identity_validation:
  reset_password:
    jwt_lifespan: '5 minutes'
    jwt_algorithm: HS256
    jwt_secret: {{authelia_jwt_secret}}

theme: dark
